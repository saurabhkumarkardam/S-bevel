- name: did
  k8s_info:
    kind: Secret
    name: "{{ steward.name }}-identity-public"
    namespace: "{{ component_ns }}"
    kubeconfig: "{{ kubernetes.config_file }}"
  register: steward_identity_public

- debug:
    var: steward_identity_public

- name: Extract and save trustee DID to file
  copy:
    # content: "{{ trustee_node_public_verif_keys.resources[0].data.value | b64decode | from_json | json_query('`verification-key`') }}"
    content: "{{ steward_identity_public.resources[0].data.value | b64decode | from_json | json_query('did') }}"
    dest: "{{ files_dir }}/{{ steward.name }}-did.json"
  vars:
    files_dir: "{{ playbook_dir }}/../../hyperledger-indy/charts/indy-genesis/files"
  when: steward_identity_public is defined and steward_identity_public.resources[0].data.value is defined

###

- name: verkey
  k8s_info:
    kind: Secret
    name: "{{ steward.name }}-node-public-verif-keys"
    namespace: "{{ component_ns }}"
    kubeconfig: "{{ kubernetes.config_file }}"
  register: steward_node_public_verif_keys

- debug:
    var: steward_node_public_verif_keys

- name: Extract and save trustee DID to file
  copy:
    # content: "{{ trustee_node_public_verif_keys.resources[0].data.value | b64decode | from_json | json_query('`verification-key`') }}"
    content: "{{ steward_node_public_verif_keys.resources[0].data.value | b64decode | from_json | json_query('\"verification-key\"') }}"
    dest: "{{ files_dir }}/{{ steward.name }}-verkey.json"
  vars:
    files_dir: "{{ playbook_dir }}/../../hyperledger-indy/charts/indy-genesis/files"
  when: steward_node_public_verif_keys is defined and steward_node_public_verif_keys.resources[0].data.value is defined

###

- name: blspop
  k8s_info:
    kind: Secret
    name: "{{ steward.name }}-node-public-bls-keys"
    namespace: "{{ component_ns }}"
    kubeconfig: "{{ kubernetes.config_file }}"
  register: steward_node_public_bls_keys

- debug:
    var: steward_node_public_bls_keys

- name: Extract and save trustee DID to file
  copy:
    content: "{{ steward_node_public_bls_keys.resources[0].data.value | b64decode | from_json | json_query('\"bls-key-pop\"') }}"
    dest: "{{ files_dir }}/{{ steward.name }}-blspop.json"
  vars:
    files_dir: "{{ playbook_dir }}/../../hyperledger-indy/charts/indy-genesis/files"
  when: steward_node_public_bls_keys is defined and steward_node_public_bls_keys.resources[0].data.value is defined

###

- name: blspub
  copy:
    content: "{{ steward_node_public_bls_keys.resources[0].data.value | b64decode | from_json | json_query('\"bls-public-key\"') }}"
    dest: "{{ files_dir }}/{{ steward.name }}-blspub.json"
  vars:
    files_dir: "{{ playbook_dir }}/../../hyperledger-indy/charts/indy-genesis/files"
  when: steward_node_public_bls_keys is defined and steward_node_public_bls_keys.resources[0].data.value is defined
