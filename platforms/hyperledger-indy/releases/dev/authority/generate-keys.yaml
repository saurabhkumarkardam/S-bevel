apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: generate-keys
  annotations:
    fluxcd.io/automated: "false"
  namespace: authority-indy
spec:
  releaseName: generate-keys-first
  interval: 1m
  chart:
    spec:
      interval: 1m
      chart: platforms/hyperledger-indy/charts/indy-key-mgmt
      sourceRef:
        kind: GitRepository
        name: flux-indy
        namespace: flux-indy
    values:
      global:
        serviceAccountName: vault-auth
        cluster:
          provider: azure
          cloudNativeServices: false
          kubernetesUrl: https://devcluster-devresourcegroup-d1d33f-kncld871.hcp.westeurope.azmk8s.io:443
        vault:
          type: hashicorp
          role: vault-role
          network: indy
          address: http://98.64.226.131:20001
          authPath: authority
          secretEngine: secretsv2
          secretPrefix: "data/authority"
      proxy:
        provider: ambassador
      settings:
        removeKeysOnDelete: true
        identities:
          trustee: authority-trustee
